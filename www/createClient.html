<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8" />
    <title>MoCA</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0,user-scalable=no" name="viewport" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!--<meta name="MobileOptimized" content="320">-->
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-fileupload/bootstrap-fileupload.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/gritter/css/jquery.gritter.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/select2/select2_metro.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/clockface/css/clockface.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-datepicker/css/datepicker.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-timepicker/compiled/timepicker.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-colorpicker/css/colorpicker.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-datetimepicker/css/datetimepicker.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/jquery-multi-select/css/multi-select.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-switch/static/stylesheets/bootstrap-switch-metro.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/jquery-tags-input/jquery.tagsinput.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-markdown/css/bootstrap-markdown.min.css">
    <link rel="stylesheet" type="text/css" href="assets/plugins/bootstrap-toastr/toastr.min.css" />
    <!-- END PAGE LEVEL STYLES -->
    <!-- BEGIN THEME STYLES -->
    <link href="assets/css/style-metronic.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style-responsive.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/plugins.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/themes/default.css" rel="stylesheet" type="text/css" id="style_color" />
    <link href="assets/css/custom.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/pages/login.css" rel="stylesheet" type="text/css" />
    <!-- END THEME STYLES -->
    <!-- BEGIN BOXWELL STYLE -->
    <link href="assets/css/boxwell.css" rel="stylesheet" type="text/css" />
    <!-- END BOXWELL STYLE -->
    <link rel="shortcut icon" href="../favicon.ico" />
    <script src="assets/scripts/site.manage.js"></script>

</head>
<!-- BEGIN BODY -->
<body class="login">
    <div class="header navbar navbar-inverse ">
        <div class="header-inner">
            <a href="index.html" class="navbar-brand">
                <span style="padding-left: 10px;">e-MoCA version 8.1</span>
            </a>
        </div>
    </div>
    <div class="content">
        <div class="login-form">
            <h3 class="form-title">Patient information</h3>
            <div class="alert alert-error hide">
                <button class="close" data-dismiss="alert"></button>
                <span>Enter patient information.</span>
            </div>
            SELECT AN EXISTING PATIENT
            <div class="form-group">
                <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
                <label class="control-label visible-ie8 visible-ie9">SELECT AN EXISTING PATIENT</label>
                <div class="input-icon">
                    <i class="icon-user"></i>
                    <select id="ddlPatients" class="form-control select2me" runat="server"></select>
                </div>
            </div>
            <div class="form-actions">
                <button id="btnSubmitDll" type="submit" class="btn purple pull-right">
                    <i class="icon-arrow-right"></i> Continue</i>
                </button>
            </div>
            <h3>OR</h3>
            CREATE A NEW PATIENT
            <div class="form-group">
                <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
                <label class="control-label visible-ie8 visible-ie9">Name</label>
                <div class="input-icon">
                    <i class="icon-user"></i>
                    <input id="txtName" class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="Name" name="name" runat="server" />
                </div>
            </div>
            DATE OF BIRTH
            <div class="form-group">
                <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
                <label class="control-label visible-ie8 visible-ie9">Name</label>
                <div class="input-group">
                    <span class="input-group-addon">
                        <i class="icon-calendar"></i>
                    </span>
                    <select id="ddlDay" class="form-control select2me" style="width:33%" data-placeholder="Sex" runat="server">
                        <option value="1" selected="selected">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                        <option value="31">31</option>
                    </select>
                    <select id="ddlMonth" class="form-control select2me" style="width:33%" data-placeholder="Sex">

                        <option value="1" selected="selected">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                    </select>
                    <select id="ddlYear" class="form-control select2me" style="width:33%" data-placeholder="Sex">

                        <option value="2014">2014</option>
                        <option value="2013">2013</option>
                        <option value="2012">2012</option>
                        <option value="2011">2011</option>
                        <option value="2010">2010</option>
                        <option value="2009">2009</option>
                        <option value="2008">2008</option>
                        <option value="2007">2007</option>
                        <option value="2006">2006</option>
                        <option value="2005">2005</option>
                        <option value="2004">2004</option>
                        <option value="2003">2003</option>
                        <option value="2002">2002</option>
                        <option value="2001">2001</option>
                        <option value="2000">2000</option>
                        <option value="1999">1999</option>
                        <option value="1998">1998</option>
                        <option value="1997">1997</option>
                        <option value="1996">1996</option>
                        <option value="1995">1995</option>
                        <option value="1994">1994</option>
                        <option value="1993">1993</option>
                        <option value="1992">1992</option>
                        <option value="1991">1991</option>
                        <option value="1990">1990</option>
                        <option value="1989">1989</option>
                        <option value="1988">1988</option>
                        <option value="1987">1987</option>
                        <option value="1986">1986</option>
                        <option value="1985">1985</option>
                        <option value="1984">1984</option>
                        <option value="1983">1983</option>
                        <option value="1982">1982</option>
                        <option value="1981">1981</option>
                        <option value="1980" selected="selected">1980</option>
                        <option value="1979">1979</option>
                        <option value="1978">1978</option>
                        <option value="1977">1977</option>
                        <option value="1976">1976</option>
                        <option value="1975">1975</option>
                        <option value="1974">1974</option>
                        <option value="1973">1973</option>
                        <option value="1972">1972</option>
                        <option value="1971">1971</option>
                        <option value="1970">1970</option>
                        <option value="1969">1969</option>
                        <option value="1968">1968</option>
                        <option value="1967">1967</option>
                        <option value="1966">1966</option>
                        <option value="1965">1965</option>
                        <option value="1964">1964</option>
                        <option value="1963">1963</option>
                        <option value="1962">1962</option>
                        <option value="1961">1961</option>
                        <option value="1960">1960</option>
                        <option value="1959">1959</option>
                        <option value="1958">1958</option>
                        <option value="1957">1957</option>
                        <option value="1956">1956</option>
                        <option value="1955">1955</option>
                        <option value="1954">1954</option>
                        <option value="1953">1953</option>
                        <option value="1952">1952</option>
                        <option value="1951">1951</option>
                        <option value="1950">1950</option>
                        <option value="1949">1949</option>
                        <option value="1948">1948</option>
                        <option value="1947">1947</option>
                        <option value="1946">1946</option>
                        <option value="1945">1945</option>
                        <option value="1944">1944</option>
                        <option value="1943">1943</option>
                        <option value="1942">1942</option>
                        <option value="1941">1941</option>
                        <option value="1940">1940</option>
                        <option value="1939">1939</option>
                        <option value="1938">1938</option>
                        <option value="1937">1937</option>
                        <option value="1936">1936</option>
                        <option value="1935">1935</option>
                        <option value="1934">1934</option>
                        <option value="1933">1933</option>
                        <option value="1932">1932</option>
                        <option value="1931">1931</option>
                        <option value="1930">1930</option>
                        <option value="1929">1929</option>
                        <option value="1928">1928</option>
                        <option value="1927">1927</option>
                        <option value="1926">1926</option>
                        <option value="1925">1925</option>
                        <option value="1924">1924</option>
                        <option value="1923">1923</option>
                        <option value="1922">1922</option>
                        <option value="1921">1921</option>
                        <option value="1920">1920</option>
                        <option value="1919">1919</option>
                        <option value="1918">1918</option>
                        <option value="1917">1917</option>
                        <option value="1916">1916</option>
                        <option value="1915">1915</option>
                        <option value="1914">1914</option>
                        <option value="1913">1913</option>
                        <option value="1912">1912</option>
                        <option value="1911">1911</option>
                        <option value="1910">1910</option>
                        <option value="1909">1909</option>
                        <option value="1908">1908</option>
                        <option value="1907">1907</option>
                        <option value="1906">1906</option>
                        <option value="1905">1905</option>
                        <option value="1904">1904</option>
                        <option value="1903">1903</option>
                        <option value="1902">1902</option>
                        <option value="1901">1901</option>
                        <option value="1900">1900</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
                <label class="control-label visible-ie8 visible-ie9"><%=Resources.patient.txt_Sex%></label>
                <div class="input-group">
                    <span class="input-group-addon">
                        <i class="icon-male"></i> <i class="icon-female"></i>
                    </span>
                    <select id="ddlSex" class="form-control select2me" data-placeholder="Sex" runat="server">
                        <option value="0">Female</option>
                        <option value="1">Male</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
                <label class="control-label visible-ie8 visible-ie9">Education</label>
                <div class="input-icon">
                    <i class="icon-certificate"></i>
                    <input id="txtEducation" class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="Education" name="Education" runat="server" />
                </div>
            </div>
            <div class="form-group">
                <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
                <label class="control-label visible-ie8 visible-ie9">Chart Number</label>
                <div class="input-icon">
                    <i class="icon-asterisk"></i>
                    <input id="txtChartNumber" class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="Chart Number" name="chartnumber" runat="server" />
                </div>
            </div>
            <div class="form-group">
                <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
                <label class="control-label visible-ie8 visible-ie9">Physicanr</label>
                <div class="input-icon">
                    <i class="icon-user-md"></i>
                    <input id="txtPhysican" class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="Physician" name="physican" runat="server" />
                </div>
            </div>
            <div class="form-actions">
                <button id="btnSubmit" type="submit" class="btn purple pull-right" runat="server">
                    <i class="icon-arrow-right"></i> Continue</i>
                </button>
            </div>
            <div class="" style="margin-top: 20px;text-align: right;">
                <button type="button" class="btn blue" id="btnContinue" onclick="window.location = 'testList.html';return false;">
                    <i class="icon-arrow-right"></i>
                    Show test results
                </button>
            </div>
        </div>
    </div>
    <div class="copyright">
        e-MoCA &copy; Copyright 2014.
    </div>
    <script src="assets/plugins/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery.cookie.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="assets/plugins/fuelux/js/spinner.min.js"></script>
    <script type="text/javascript" src="assets/plugins/select2/select2.min.js"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
    <script type="text/javascript" src="assets/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js"></script>
    <script type="text/javascript" src="assets/plugins/jquery.input-ip-address-control-1.0.min.js"></script>
    <script type="text/javascript" src="assets/plugins/jquery-multi-select/js/jquery.multi-select.js"></script>
    <script src="assets/plugins/bootstrap-maxlength/bootstrap-maxlength.min.js" type="text/javascript"></script>
    <script src="assets/plugins/bootstrap-toastr/toastr.min.js"></script>
    <script src="assets/scripts/jquery.session.js"></script>
    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN PAGE LEVEL SCRIPTS -->
    <script src="assets/scripts/ui-toastr.js"></script>
    <script src="assets/scripts/app.js"></script>
    <script src="assets/scripts/form-components.js"></script>
    <script src="assets/scripts/jquery.numeric.js"></script>
    <!-- END PAGE LEVEL SCRIPTS -->
    <script src="assets/scripts/phonegap-1.1.0.js"></script>
    <script src="assets/scripts/db.manager.js"></script>
    <script src="assets/scripts/jquery.bpopup.min.js"></script>
    <script>

        $("#btnSubmitDll").click(function () {
            if($("#ddlPatients").find("option:selected").val()){
                var patientId = $("#ddlPatients").find("option:selected").val();
                console.log(patientId)
                $.session.set('clientId', patientId);
                window.location = "start.html";
            }else {
                $('#SendMail').bPopup();
            }
            return false;
            
        });

      
 

        $("#btnSubmit").click(function () {
            var birthDay = new Date($("#ddlYear option:selected").val(), parseInt($("#ddlMonth option:selected").val()) - 1, $("#ddlDay option:selected").val())
            var date = SqliteDate(birthDay);
           
            var patient =
              {
                  tableName: 'MocaTestClients',
                  data: [{
                      name: $("#txtName").val(),
                      dateOfBirth: date,// wcfDate,
                      gender: $("#ddlSex").find("option:selected").val(),
                      physican: $("#txtPhysican").val(),
                      education: $("#txtEducation").val(),
                      chartNumber: $("#txtChartNumber").val()
                  }]
              };
            
            var text = '';
            var Alert = function (text) {
                $('#SendMail').bPopup({
                    onOpen : function () {
                       $('#infoText').text('The field "'+text+'" is required');
                    }
                });
            };
            var out = patient.data[0];
            if(out.name && out.physican && out.education && out.chartNumber){
                DB.insertData(patient, function (data) {
                    log(data);
                    $.session.set('clientId', data.insertId);
                    window.location = "start.html";
                });
            }else {
                // if(!out.name){
                    // text = 'Name';
                    // Alert(text);
                // }else if(!out.education){
                    // text = 'Education';
                    // Alert(text);
                // }else if(!out.chartNumber){
                    // text = 'ChartNumber';
                    // Alert(text);
                // }else if(!out.physican){
                    // text = 'Physican';
                    // Alert(text);
                // }
                
                
                
                var text = '';
                if(!out.name){
                    text = 'The field "Name" is required';
                    $('#txtName').closest('.input-icon').css({'border':'1px solid red'});
                    if(!$('#txtName').closest('.input-icon').next().hasClass('pError')){
                        $('#txtName').closest('.input-icon').after('<p style="color:red;margin-top: 5px;" class="pError">'+text+'</p>');
                    }
                }else {
                    $('#txtName').closest('.input-icon').css({'border':'none'}).nextAll('.pError').remove();
                }
                if(!out.education){
                     text = 'The field "Education" is required';
                    $('#txtEducation').closest('.input-icon').css({'border':'1px solid red'});
                    if(!$('#txtEducation').closest('.input-icon').next().hasClass('pError')){
                        $('#txtEducation').closest('.input-icon').after('<p style="color:red;margin-top: 5px;" class="pError">'+text+'</p>');
                    }
                }else {
                    $('#txtEducation').closest('.input-icon').css({'border':'none'}).nextAll('.pError').remove();
                }
                if(!out.chartNumber){
                    text = 'The field "Chart Number" is required';
                    $('#txtChartNumber').closest('.input-icon').css({'border':'1px solid red'});
                    if(!$('#txtChartNumber').closest('.input-icon').next().hasClass('pError')){
                        $('#txtChartNumber').closest('.input-icon').after('<p style="color:red;margin-top: 5px;" class="pError">'+text+'</p>');
                    }
                }else {
                    $('#txtChartNumber').closest('.input-icon').css({'border':'none'}).nextAll('.pError').remove();
                }
                if(!out.physican){
                    text = 'The field "Physician" is required';
                    $('#txtPhysican').closest('.input-icon').css({'border':'1px solid red'});
                    if(!$('#txtPhysican').closest('.input-icon').next().hasClass('pError')){
                        $('#txtPhysican').closest('.input-icon').after('<p style="color:red;margin-top: 5px;" class="pError">'+text+'</p>');
                    }
                }else {
                    $('#txtPhysican').closest('.input-icon').css({'border':'none'}).nextAll('.pError').remove();
                }
                
            }
            return false;
        });

        
        jQuery(document).ready(function () {


            // initiate layout and plugins
            App.init();
            UIToastr.init();
            FormComponents.init();

            DB.selectData('select * from MocaTestClients', function (data) {
                for (var i = 0; i < data.rows.length; i++) {
                    var v = data.rows.item(i);
                    var option = $('<option>', {
                        text: v.name + ' | ' + v.physican,
                        value: v.clientID
                    });
                    $('#ddlPatients').append(option);
                };
                $('#ddlPatients').select2({
                    placeholder: "Select",
                    allowClear: true
                });
            });

            //$.ajax({
            //    type: "GET",
            //    url: currentNetwork + "Service.svc/GetPatientList",
            //    dataType: "json",
            //    success: function (data) {

            //        $.each(data.GetPatientListResult, function (k, v) {
            //            var option = $('<option>', {
            //                text: v.Name + ' | ' + v.Physican,
            //                value: v.Id
            //            });
            //            $('#ddlPatients').append(option);
            //        });

            //        $('#ddlPatients').select2({
            //            placeholder: "Select",
            //            allowClear: true
            //        });
            //    },

            //    error: function () {
            //        console.log("error");
            //    }
            //});

        });
    </script>
    <div class="content" id="SendMail" style="display: none; width: 500px !important;">
        <div class="login-form">
            <h3 class="form-title" id="infoText" style="font-size: 20px;text-align: center;">Pleace create a new patient!</h3>
            <div class="alert alert-error hide">
                <button class="close" data-dismiss="alert"></button>
                <span></span>
            </div>
            <!-- <div class="form-group">
                <div class="input-icon">
                    <i class="icon-envelope"></i>
                    <input class="form-control placeholder-no-fix" type="text" placeholder="Email" name="email" runat="server" id="txtEmail" />
                </div>
            </div> -->
            <div class="form-actions">
    
                <!-- <button id="btnSend" type="submit" class="btn purple pull-right" runat="server">
                    <i class="icon-ok"></i> Send
                </button> -->
                <button id="" onclick="$('#SendMail').bPopup().close();" type="submit" class="bCloce btn purple pull-right" style="margin-right: 10px;">
                    <i class="icon-cancel"></i> OK
                </button>
            </div>
        </div>
    </div>
</body>
<!-- END BODY -->
</html>
